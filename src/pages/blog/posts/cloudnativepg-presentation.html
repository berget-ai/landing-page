<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>CloudNativePG vs Bitnami PostgreSQL</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/theme/white.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/highlight/monokai.css"
    />

    <style>
      .reveal .slides section {
        text-align: left;
      }
      .reveal .slides section h1,
      .reveal .slides section h2,
      .reveal .slides section h3 {
        text-align: center;
      }
      .reveal .slides section.center {
        text-align: center;
      }
      .reveal .slides section .fragment {
        margin-bottom: 1em;
      }
      .reveal .slides section .code-block {
        background: #f8f8f8;
        padding: 1em;
        border-radius: 5px;
        margin: 1em 0;
        font-family: monospace;
        font-size: 0.8em;
      }
      .reveal .slides section .highlight {
        color: #e91e63;
        font-weight: bold;
      }
      .reveal .slides section .success {
        color: #4caf50;
        font-weight: bold;
      }
      .reveal .slides section .warning {
        color: #ff9800;
        font-weight: bold;
      }
      .reveal .slides section .danger {
        color: #f44336;
        font-weight: bold;
      }
      .reveal .slides table {
        margin: 1em 0;
      }
      .reveal .slides table th,
      .reveal .slides table td {
        padding: 0.5em;
        text-align: left;
        border: 1px solid #ddd;
      }
      .reveal .slides table th {
        background-color: #f2f2f2;
      }
      .reveal .slides .two-column {
        display: flex;
        justify-content: space-between;
      }
      .reveal .slides .two-column .column {
        width: 48%;
      }
      .reveal .slides .architecture-diagram {
        text-align: center;
        font-family: monospace;
        background: #f0f0f0;
        padding: 1em;
        border-radius: 5px;
        margin: 1em 0;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <!-- Slide 1: Title -->
        <section>
          <h1>CloudNativePG vs Bitnami PostgreSQL</h1>
          <h3>VarfÃ¶r vÃ¤lja en native operator fÃ¶r din databas</h3>
          <p><small>Christian Landgren</small></p>
        </section>

        <!-- Slide 2: The Problem -->
        <section>
          <h2>Vad Ã¤r problemet vi lÃ¶ser?</h2>
          <div class="fragment">
            <p class="highlight">
              Att drifta en databas i produktion â‰  att starta en container
            </p>
          </div>
          <div class="fragment">
            <ul>
              <li>ğŸ›¡ï¸ <strong>DriftsÃ¤kerhet</strong>: 24/7 tillgÃ¤nglighet</li>
              <li>ğŸ”„ <strong>Redundans</strong>: Inga enskilda fel punkter</li>
              <li>
                ğŸ’¾ <strong>Backup</strong>: Automatiska, testade Ã¥terstÃ¤llningar
              </li>
              <li>ğŸ”§ <strong>SjÃ¤lvhelande</strong>: Automatisk Ã¥terhÃ¤mtning</li>
              <li>ğŸ“ˆ <strong>Skalning</strong>: VÃ¤x med din applikation</li>
              <li>ğŸ”’ <strong>SÃ¤kerhet</strong>: Kryptering och auditering</li>
            </ul>
          </div>
        </section>

        <!-- Slide 3: Comparison Table -->
        <section>
          <h2>JÃ¤mfÃ¶relse: PostgreSQL i Kubernetes</h2>
          <table style="font-size: 0.7em">
            <thead>
              <tr>
                <th>Funktion</th>
                <th>Bitnami</th>
                <th>CloudNativePG</th>
                <th>CrunchyData</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Installation</strong></td>
                <td>Helm, 5 min</td>
                <td>Operator, 10 min</td>
                <td>Operator, 15 min</td>
              </tr>
              <tr>
                <td><strong>High Availability</strong></td>
                <td class="danger">Manuell</td>
                <td class="success">Automatisk</td>
                <td class="success">Automatisk</td>
              </tr>
              <tr>
                <td><strong>Backup/Restore</strong></td>
                <td class="warning">GrundlÃ¤ggande</td>
                <td class="success">Enterprise</td>
                <td class="success">Inbyggd</td>
              </tr>
              <tr>
                <td><strong>Version Support</strong></td>
                <td class="danger">Endast senaste</td>
                <td class="success">Multi-version</td>
                <td class="success">Multi-version</td>
              </tr>
              <tr>
                <td><strong>Production Ready</strong></td>
                <td class="warning">Med konfig</td>
                <td class="success">Out-of-the-box</td>
                <td class="success">Enterprise</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Slide 4: Bitnami Problems -->
        <section>
          <h2>Bitnami-problemet: Version Lock-in</h2>
          <div class="fragment">
            <p class="danger">ğŸš¨ Endast senaste PostgreSQL versionen stÃ¶ds!</p>
          </div>
          <div class="fragment">
            <div class="code-block">
              # Bitnami Docker Hub - endast PostgreSQL 16.x docker pull
              bitnami/postgresql:latest # PostgreSQL 16.x docker pull
              bitnami/postgresql:14 # ERROR: Tag not found!
            </div>
          </div>
          <div class="fragment">
            <h3>Konsekvenser:</h3>
            <ul>
              <li class="danger">
                Tvingad uppgradering kan krossa din applikation
              </li>
              <li class="danger">OmÃ¶jligt att testa uppgraderingar gradvis</li>
              <li class="danger">
                Tredjepartsverktyg kanske inte stÃ¶djer senaste version
              </li>
            </ul>
          </div>
        </section>

        <!-- Slide 5: Two Philosophies -->
        <section>
          <h2>TvÃ¥ olika filosofier</h2>
          <div class="two-column">
            <div class="column">
              <h3>Bitnami PostgreSQL</h3>
              <ul>
                <li>StatefulSets</li>
                <li>Generisk konfiguration</li>
                <li>Manuell skalning</li>
                <li>BegrÃ¤nsad automation</li>
                <li>"One-size-fits-all"</li>
              </ul>
            </div>
            <div class="column">
              <h3>CloudNativePG</h3>
              <ul>
                <li>CRDs fÃ¶r deklarativ hantering</li>
                <li>Automatisk failover</li>
                <li>Native streaming replication</li>
                <li>Inbyggd backup/restore</li>
                <li>PostgreSQL-specifik optimering</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Slide 6: Installation -->
        <section>
          <h2>Installation med Helm</h2>
          <div class="two-column">
            <div class="column">
              <h3>Bitnami (snabb start)</h3>
              <div class="code-block">
                helm repo add bitnami https://charts.bitnami.com/bitnami helm
                install postgres bitnami/postgresql \ --set
                auth.postgresPassword=secret \ --set auth.database=myapp
              </div>
            </div>
            <div class="column">
              <h3>CloudNativePG (produktion)</h3>
              <div class="code-block">
                helm repo add cloudnative-pg \
                https://cloudnative-pg.github.io/charts helm install cnpg
                cloudnative-pg/cloudnative-pg \ --namespace cnpg-system
                --create-namespace
              </div>
            </div>
          </div>
        </section>

        <!-- Slide 7: Architecture Choices -->
        <section>
          <h2>Arkitekturval: Multi-tenancy</h2>
          <div class="fragment">
            <h3>Alternativ 1: Ett kluster per applikation</h3>
            <div class="architecture-diagram">
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br />
              â”‚ odoo-ns â”‚ â”‚ keycloak-ns â”‚<br />
              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚<br />
              â”‚ â”‚postgres â”‚ â”‚ â”‚ â”‚postgres â”‚ â”‚<br />
              â”‚ â”‚ odoo â”‚ â”‚ â”‚ â”‚keycloak â”‚ â”‚<br />
              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚<br />
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
            <p>
              <span class="success">âœ… Full isolering</span> |
              <span class="warning">âŒ HÃ¶gre kostnad</span>
            </p>
          </div>
        </section>

        <!-- Slide 8: Architecture Choice 2 -->
        <section>
          <h2>Arkitekturval: Multi-tenancy</h2>
          <div class="fragment">
            <h3>Alternativ 2: En databas per applikation i delat kluster</h3>
            <div class="architecture-diagram">
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br />
              â”‚ postgres-ns â”‚<br />
              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚<br />
              â”‚ â”‚ shared-postgres â”‚ â”‚<br />
              â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚<br />
              â”‚ â”‚ â”‚odoo â”‚ â”‚ keycloak â”‚ â”‚ â”‚<br />
              â”‚ â”‚ â”‚ db â”‚ â”‚ db â”‚ â”‚ â”‚<br />
              â”‚ â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚<br />
              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚<br />
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
            <p>
              <span class="success">âœ… Resurseffektivt</span> |
              <span class="warning">âŒ Delad version</span>
            </p>
          </div>
        </section>

        <!-- Slide 9: Architecture Recommendation -->
        <section>
          <h2>Rekommendation: VÃ¤lj baserat pÃ¥ behov</h2>
          <table style="font-size: 0.8em">
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Rekommendation</th>
                <th>Anledning</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>SmÃ¥ team, fÃ¥ appar</td>
                <td class="success">Delat kluster</td>
                <td>Kostnadseffektivt</td>
              </tr>
              <tr>
                <td>Enterprise, mÃ¥nga appar</td>
                <td class="success">Ett kluster per app</td>
                <td>Full isolering</td>
              </tr>
              <tr>
                <td>Dev/Test miljÃ¶er</td>
                <td class="success">Delat kluster</td>
                <td>Snabbt och billigt</td>
              </tr>
              <tr>
                <td>Produktion, kritiska appar</td>
                <td class="success">Ett kluster per app</td>
                <td>Zero blast radius</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Slide 10: Simple Setup -->
        <section>
          <h2>Enkel development setup</h2>
          <div class="code-block">
            apiVersion: postgresql.cnpg.io/v1 kind: Cluster metadata: name:
            postgres-dev namespace: development spec: instances: 1 bootstrap:
            initdb: database: app_dev owner: app_user secret: name:
            postgres-credentials storage: size: 10Gi
          </div>
          <p class="success">âœ… Klart pÃ¥ 2 minuter!</p>
        </section>

        <!-- Slide 11: Production Setup -->
        <section>
          <h2>Production setup med HA</h2>
          <div class="code-block" style="font-size: 0.6em">
            apiVersion: postgresql.cnpg.io/v1 kind: Cluster metadata: name:
            postgres-prod namespace: production spec: instances: 3 # 1 primary +
            2 replicas primaryUpdateStrategy: unsupervised # Automatisk failover
            backup: retentionPolicy: "30d" barmanObjectStore: destinationPath:
            "s3://company-backups/postgres-prod" monitoring: enabled: true
          </div>
          <p class="success">âœ… Enterprise-grade pÃ¥ 5 minuter!</p>
        </section>

        <!-- Slide 12: Connection Strings -->
        <section>
          <h2>Connection strings</h2>
          <div class="code-block">
            # Standard format
            postgresql://user:password@cluster-rw.namespace.svc.cluster.local:5432/database?sslmode=require
            # Exempel fÃ¶r vÃ¥r setup
            postgresql://app_user:password@postgres-prod-rw.production.svc.cluster.local:5432/app_prod?sslmode=require
          </div>
          <div class="fragment">
            <h3>Automatiskt skapade services:</h3>
            <ul>
              <li><code>postgres-prod-rw</code> - Primary fÃ¶r writes</li>
              <li><code>postgres-prod-ro</code> - Load-balanced reads</li>
              <li><code>postgres-prod-r</code> - Round-robin alla instanser</li>
            </ul>
          </div>
        </section>

        <!-- Slide 13: Scaling -->
        <section>
          <h2>Skalning och read/write separation</h2>
          <div class="code-block">
            # Skala upp read replicas kubectl patch cluster postgres-prod
            --type='merge' -p '{"spec":{"instances":5}}' # Skapar automatiskt: #
            - 1 primary (writes) # - 4 replicas (reads)
          </div>
          <div class="fragment">
            <h3>Application code:</h3>
            <div class="code-block" style="font-size: 0.7em">
              // Writes â†’ postgres-prod-rw const writeUrl =
              process.env.DATABASE_WRITE_URL // Reads â†’ postgres-prod-ro const
              readUrl = process.env.DATABASE_READ_URL
            </div>
          </div>
        </section>

        <!-- Slide 14: Backup -->
        <section>
          <h2>Automatisk backup och recovery</h2>
          <div class="code-block">
            # Schemalagd backup apiVersion: postgresql.cnpg.io/v1 kind:
            ScheduledBackup metadata: name: daily-backup spec: schedule: "0 2 *
            * *" # Varje natt kl 02:00 cluster: name: postgres-prod
            retentionPolicy: "30d"
          </div>
          <div class="fragment">
            <p class="success">âœ… Continuous WAL archiving</p>
            <p class="success">âœ… Point-in-time recovery</p>
            <p class="success">âœ… Cross-region disaster recovery</p>
          </div>
        </section>

        <!-- Slide 15: Monitoring -->
        <section>
          <h2>Monitoring och observability</h2>
          <div class="fragment">
            <h3>Inbyggda metrics:</h3>
            <ul>
              <li>ğŸ“Š Connection count</li>
              <li>ğŸ“ˆ Transaction rates</li>
              <li>â±ï¸ Replication lag</li>
              <li>ğŸ’¾ Database size</li>
              <li>ğŸ¯ Cache hit ratio</li>
            </ul>
          </div>
          <div class="fragment">
            <div class="code-block">
              # Prometheus exporter kubectl get service postgres-prod -o
              jsonpath='{.spec.metrics}'
            </div>
          </div>
        </section>

        <!-- Slide 16: Security -->
        <section>
          <h2>Security best practices</h2>
          <div class="fragment">
            <ul>
              <li>
                ğŸ”’ <strong>TLS encryption</strong> med cert-manager integration
              </li>
              <li>ğŸ‘¥ <strong>RBAC</strong> fÃ¶r access control</li>
              <li>ğŸ“ <strong>Audit logging</strong> med PGAudit</li>
              <li>ğŸŒ <strong>Network policies</strong> fÃ¶r isolering</li>
              <li>ğŸ›¡ï¸ <strong>Pod security</strong> policies</li>
            </ul>
          </div>
          <div class="fragment">
            <div class="code-block">
              # Enable TLS certificates: serverTLSSecret: postgres-server-tls
              replicationTLSSecret: postgres-replication-tls
            </div>
          </div>
        </section>

        <!-- Slide 17: Migration -->
        <section>
          <h2>Migration frÃ¥n Bitnami</h2>
          <div class="code-block" style="font-size: 0.7em">
            # 1. Backup befintlig databas kubectl exec -it bitnami-postgresql-0
            -- pg_dump > backup.sql # 2. Installera CloudNativePG helm install
            cnpg cloudnative-pg/cloudnative-pg # 3. Skapa nytt cluster kubectl
            apply -f cluster-prod.yaml # 4. Restore data kubectl exec -it
            postgres-prod-1 -- psql < backup.sql # 5. Uppdatera connection
            strings # Byt: bitnami-postgresql â†’ postgres-prod-rw
          </div>
        </section>

        <!-- Slide 18: Cost Comparison -->
        <section>
          <h2>KostnadsjÃ¤mfÃ¶relse</h2>
          <div class="fragment">
            <table style="font-size: 0.8em">
              <thead>
                <tr>
                  <th>Aspekt</th>
                  <th>Bitnami</th>
                  <th>CloudNativePG</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Initial setup</td>
                  <td>2 timmar</td>
                  <td>4 timmar</td>
                </tr>
                <tr>
                  <td>ProduktionssÃ¤ttning</td>
                  <td class="danger">40 timmar</td>
                  <td class="success">8 timmar</td>
                </tr>
                <tr>
                  <td>Drift (1 Ã¥r)</td>
                  <td class="danger">200 timmar</td>
                  <td class="success">20 timmar</td>
                </tr>
                <tr>
                  <td><strong>Totalt fÃ¶rsta Ã¥ret</strong></td>
                  <td class="danger">242 timmar</td>
                  <td class="success">32 timmar</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="fragment">
            <p class="success">
              ğŸ’° CloudNativePG betalar sig efter fÃ¶rsta mÃ¥naden!
            </p>
          </div>
        </section>

        <!-- Slide 19: When to Choose What -->
        <section>
          <h2>NÃ¤r ska du vÃ¤lja vad?</h2>
          <div class="two-column">
            <div class="column">
              <h3 class="success">âœ… VÃ¤lj CloudNativePG</h3>
              <ul>
                <li>Produktionsklar HA</li>
                <li>Enterprise backup</li>
                <li>Declarative management</li>
                <li>Native K8s integration</li>
                <li>Multi-version support</li>
                <li>Skalbarhet frÃ¥n devâ†’prod</li>
              </ul>
            </div>
            <div class="column">
              <h3 class="warning">âš ï¸ VÃ¤lj Bitnami</h3>
              <ul>
                <li>Snabb prototype</li>
                <li>Enkel installation</li>
                <li>Accepterar version lock-in</li>
                <li>Generisk databas</li>
                <li><strong>Byt innan produktion!</strong></li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Slide 20: Key Takeaways -->
        <section>
          <h2>Key Takeaways</h2>
          <div class="fragment">
            <p class="highlight">
              ğŸ¯ FrÃ¥gan Ã¤r inte OM du ska anvÃ¤nda en PostgreSQL operator, utan
              NÃ„R
            </p>
          </div>
          <div class="fragment">
            <ul>
              <li>
                ğŸš€ <strong>CloudNativePG</strong> = Arkitektonisk uppgradering
              </li>
              <li>
                ğŸ’¡ <strong>Bitnami</strong> = Bra fÃ¶r prototyping, dÃ¥ligt fÃ¶r
                produktion
              </li>
              <li>
                âš¡ <strong>Version lock-in</strong> kan kosta mer Ã¤n hela
                implementationen
              </li>
              <li>
                ğŸ—ï¸ <strong>Hybrid approach</strong> = BÃ¤sta av tvÃ¥ vÃ¤rldar
              </li>
            </ul>
          </div>
        </section>

        <!-- Slide 21: Future -->
        <section class="center">
          <h2>The future of database operations is...</h2>
          <div class="fragment">
            <h1 class="success">Declarative</h1>
          </div>
          <div class="fragment">
            <h1 class="success">Automated</h1>
          </div>
          <div class="fragment">
            <h1 class="success">Cloud-native</h1>
          </div>
          <div class="fragment">
            <p class="highlight">
              CloudNativePG isn't just keeping up with that futureâ€”it's defining
              it.
            </p>
          </div>
        </section>

        <!-- Slide 22: Questions -->
        <section class="center">
          <h1>FrÃ¥gor?</h1>
          <div class="fragment">
            <p>ğŸ“§ christian@landgren.nu</p>
          </div>
        </section>

        <!-- Slide 23: Thank You -->
        <section class="center">
          <h1>Tack!</h1>
          <div class="fragment">
            <p>LÃ¤s hela blogginlÃ¤gget pÃ¥:</p>
            <p class="highlight">
              berget.ai/blog/cloudnativepg-vs-bitnami-postgresql
            </p>
          </div>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/highlight/highlight.js"></script>
    <script>
      Reveal.initialize({
        hash: true,
        controls: true,
        progress: true,
        center: false,
        transition: 'slide',
        plugins: [RevealHighlight],
      })
    </script>
  </body>
</html>
